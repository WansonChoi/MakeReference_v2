# NomenCleaner
------

created by W. Choi(wschoi.bhlab@gmail.com) and B. Han(buhm.han@gmail.com).

### [ Introduction ]

**NomenCleaner** transforms a ped file with HLA alleles in various form to new ped file of which HLA alleles are in the form which user requests (ex. "Standard (Maximum) 4-field Nomenclauture names", "G-group", or "P-group").

You can find more information about the official HLA allele nomenclature defined by "IMGT-HLA" organization([go to IMGT-HLA Nomenclature](http://hla.alleles.org/nomenclature/naming.html)), which indicates that "Maximum 4-field Nomenclature" is currently used as the standard for HLA allele names.


<br>
### [ Input and Output ]
This module takes 

1. .ped file, 
2. .iat file, 
3. Requested Output format("1-field", "2-field", "3-field", "4-field(Stanadard)", "P-group" or "G-group")

and generates transformed .ped file.  

Here, extension '.iat' means 'I'ntegrated 'A'llele 'T'able. I introduced this file for utilizable purpose.


> (Note) '.iat' file can be generated by the module "ClassifyGroups.py".

<br>
I'm sure some users might be curious how this module can determine 4-field HLA allele names when given only 1, 2 or 3-field HLA alleles. **I want to clarify that this module neither conduct a prediction nor make a guess. It just chooses a first option among possible candidates.** For example, Let's assume HLA allele named "A\*01:01" is given, then the possible candidates will be,

Allele | G_group | P_group
-------|---------|---------
A*01:01:01:01|01:01:01G|01:01P
A*01:01:01:02N|01:01:01G|0
A*01:01:01:03|01:01:01G|01:01P
A*01:01:01:04|01:01:01G|01:01P
A*01:01:01:05|01:01:01G|01:01P
A*01:01:01:06|01:01:01G|01:01P
A*01:01:01:07|01:01:01G|01:01P
A*01:01:01:08|01:01:01G|01:01P
A*01:01:01:09|01:01:01G|01:01P
A*01:01:01:10|01:01:01G|01:01P
A*01:01:01:11|01:01:01G|01:01P
A*01:01:01:12|01:01:01G|01:01P
A*01:01:01:13|01:01:01G|01:01P
A*01:01:02|01:01:02|01:01P
A*01:01:03|01:01:03|01:01P
A*01:01:04|01:01:04|01:01P
A*01:01:05|01:01:05|01:01P
...|...|...

The total number of possible candidates for "A\*01:01" is 96. But this module will just transform "A\*01:01" to "A\*01:01:01:01".


<br>
### [ Example ]

#### (Case 1): Transforming undetermined allele names to 4-field standard names. 

I'll assume that users are in "makereference_recode_v2/" directory.

```console

$ python3 ./src/NomenCleaner.py \
            -ped ./data/NomenCleaner/DummyPED.standard.100.ped \
            -iat ./data/ClassifyGroups/INTEGRATED_ALLELE_TABLE.imgt370.iat \
            -o ./Transformed.standard.100 \
            --4field

```

You don't need to specify '.ped' extension in '-o' option.  

Let's check before and after in case of HLA-A, B, C. Before conducting transformation, the first 5 rows in 'DummyPED.standard.100.ped' are,

A1 | A2 | B1 | B2 | C1 | C2
---|----|----|----|----|----
A*7402|68|B*59|B*52:01|1701|0702
6801|29:02|47:01|4402|C*05:01|06:02
A*29:01|A*24:02|4006|B*3901|04:01|C*0304
A*03:01|02|B*3501|35108|C*17|04
A*01:01|02101|B*1501|15:17|07:02|06:02
68:02|0101|5201|B*35101|C*04:01|C*17


(I intentionally prepared alleles in various format to show that it can deal with it such as Gene captioned or not, No colon or not, 1, 2, 3, 4-field, etc.)  

After transformation, the equivalent part in the output 'Transformed.standard.100.4field.ped' will be,

A1 | A2 | B1 | B2 | C1 | C2
---|----|----|----|----|----
A*74:02:01:01|A*68:01:01:01|B*59:01:01:01|B*52:01:01:01|C*17:01:01:01|C*07:02:01:01
A*68:01:01:01|A*29:02:01:01|B*47:01:01:01|B*44:02:01:01|C*05:01:01:01|C*06:02:01:01
A*29:01:01:01|A*24:02:01:01|B*40:06:01:01|B*39:01:01:01|C*04:01:01:01|C*03:04:01:01
A*03:01:01:01|A*02:01:01:01|B*35:01:01:01|B*35:108:01|C*17:01:01:01|C*04:01:01:01
A*01:01:01:01|A*02:101:01|B*15:01:01:01|B*15:17:01:01|C*07:02:01:01|C*06:02:01:01
A*68:02:01:01|A*01:01:01:01|B*52:01:01:01|B*35:101:01|C*04:01:01:01|C*17:01:01:01


HLA Gene caption("A\*", "B\*", etc.) will be included in default.
Note that not every allele name has a corresponding 4 fields name. Our module converts names to "maximum possible fields" that correpond to the names.


<br>
#### (Case 2): Transforming 4-field standard names to P or G-group allele names.  

```console

$ python3 ./src/NomenCleaner.py \
            -ped data/NomenCleaner/DummyPED.standard.100.ped \
            -iat data/ClassifyGroups/INTEGRATED_ALLELE_TABLE.imgt3320.iat \
            -o ./Transformed.standard.100 \
            --G-group

```

This command will generate a new ped file with G-group allele names. Input ped file is same as the one in (Case 1).

A1 | A2 | B1 | B2 | C1 | C2
---|----|----|----|----|----
A*7402|68|B*59|B*52:01|1701|0702
6801|29:02|47:01|4402|C*05:01|06:02
A*29:01|A*24:02|4006|B*3901|04:01|C*0304
A*03:01|02|B*3501|35108|C*17|04
A*01:01|02101|B*1501|15:17|07:02|06:02
68:02|0101|5201|B*35101|C*04:01|C*17

Then, those alleles will be transformed into G-group form,

A1 | A2 | B1 | B2 | C1 | C2
---|----|----|----|----|----
A*74:01:01G|A*68:01:01G|B*59:01:01G|B*52:01:01G|C*17:01:01G|C*07:02:01G
A*68:01:01G|A*29:02:01G|B*47:01:01G|B*44:02:01G|C*05:01:01G|C*06:02:01G
A*29:01:01G|A*24:02:01G|B*40:06:01G|B*39:01:01G|C*04:01:01G|C*03:04:01G
A*03:01:01G|A*02:01:01G|B*35:01:01G|B*35:108:01|C*17:01:01G|C*04:01:01G
A*01:01:01G|A*02:101:01|B*15:01:01G|B*15:17:01G|C*07:02:01G|C*06:02:01G
A*68:02:01G|A*01:01:01G|B*52:01:01G|B*35:101:01|C*04:01:01G|C*17:01:01G

Likewise, result of transforming 4-field standard names to P-group allele names is,

A1 | A2 | B1 | B2 | C1 | C2
---|----|----|----|----|----
A*74:01P|A*68:01P|B*59:01P|B*52:01P|C*17:01P|C*07:02P
A*68:01P|A*29:02P|B*47:01P|B*44:02P|C*05:01P|C*06:02P
A*29:01P|A*24:02P|B*40:06P|B*39:01P|C*04:01P|C*03:04P
A*03:01P|A*02:01P|B*35:01P|B*35:108P|C*17:01P|C*04:01P
A*01:01P|A*02:101P|B*15:01P|B*15:17P|C*07:02P|C*06:02P
A*68:02P|A*01:01P|B*52:01P|B*35:101P|C*04:01P|C*17:01P

<br>
#### (Case 3 - 1): Trasforming P or G-group alleles to standard 4-field alleles.

Users can also take a ped file with P or G-group alleles as an input to this module. In this case, you need to give a path of the input ped file by using '-ped-Ggroup' or '-ped-Pgroup' instead of '-ped'. For example, 

```console

$ python3 src/NomenCleaner.py \
            -ped-Ggroup data/NomenCleaner/DummyPED.Ggroup.Ncap.dc.100.ped \
            -iat data/ClassifyGroups/INTEGRATED_ALLELE_TABLE.imgt3320.iat \
            -o Transformed.Ggroup.100 \
            --4field

```

This command will transform a ped file with G-group alleles to 4-field standard ped file.  

Before, 

A1 | A2 | B1 | B2 | C1 | C2 
---|----|----|----|----|----
30:02:08|03:01:28|56:48|15:165|05:103:02|06:212
02:01:01G|24:296|58:16:01|15:256|14:21N|07:520
02:200|26:76|07:176|40:341|16:30N|02:12
26:01:37|02:22:01G|07:35|35:66|07:101|04:130
02:674|24:22|15:10:04|15:25:01G|04:184|07:10
32:82|30:11:02|15:01:01G|40:01:01G|03:04:01G|07:29:01

After,  

A1 | A2 | B1 | B2 | C1 | C2 
---|----|----|----|----|----
A*30:02:08|A*03:01:28|B*56:48|B*15:165|C*05:103:02|C*06:212
A*02:01:01:01|A*24:296|B*58:16:01|B*15:256|C*14:21N|C*07:520
A*02:200|A*26:76|B*07:176|B*40:341|C*16:30N|C*02:12
A*26:01:37|A*02:22:01:01|B*07:35|B*35:66|C*07:101|C*04:130
A*02:674|A*24:22|B*15:10:04|B*15:25:01|C*04:184|C*07:10
A*32:82|A*30:11:02|B*15:01:01:01|B*40:01:01|C*03:04:01:01|C*07:29:01

  

Same job taking P-group ped file as input can be conducted.

```console

$ python3 src/NomenCleaner.py \
            -ped-Pgroup data/NomenCleaner/DummyPED.Pgroup.Ncap.dc.100.ped \
            -iat data/ClassifyGroups/INTEGRATED_ALLELE_TABLE.imgt3320.iat \
            -o Transformed.Pgroup.100 \
            --4field

```

Before, 

A1 | A2 | B1 | B2 | C1 | C2 
---|----|----|----|----|----
26:91|02:19|0|35:07|04:224|05:01P
68:34|29:01P|37:01P|27:27|07:532|07:478
02:155|02:307|41:01P|35:04P|06:02P|01:102
02:48|34:09|15:344|15:39P|04:172|08:124
68:113|26:89|35:01P|15:121|05:01P|17:28
03:231P|33:109|27:121|13:23|07:190|07:53

After,  

A1 | A2 | B1 | B2 | C1 | C2 
---|----|----|----|----|----
A*26:91|A*02:19|0|B*35:07|C*04:224|C*05:01:01:01
A*68:34|A*29:01:01:01|B*37:01:01:01|B*27:27|C*07:532|C*07:478
A*02:155|A*02:307|B*41:01:01|B*35:04:01|C*06:02:01:01|C*01:102
A*02:48|A*34:09|B*15:344|B*15:39:01|C*04:172|C*08:124
A*68:113|A*26:89|B*35:01:01:01|B*15:121|C*05:01:01:01|C*17:28
A*03:231:01|A*33:109|B*27:121|B*13:23|C*07:190|C*07:53


<br>
#### (Case 3 - 2): From P or G-group alleles without colon(digit and field information) to standard 4-field alleles.

In case that you got a ped file with P or G-group alleles but not without colon, where you can't assure digits for those alleles, this module handle this problem. As i said it won't be a prefect guess, however, it will find the most probable and prime candidate.

For example, when you are given a ped file with G-group allele names without colon, no digit information to determine fields, then you can get it through,

```console

$ python3 src/NomenCleaner.py \
           -ped-Ggroup data/NomenCleaner/DummyPED.Ggroup.Ncap.Ndc.100.ped \
           -iat data/ClassifyGroups/INTEGRATED_ALLELE_TABLE.imgt3320.iat \
           -o Transformed.Ggroup.100.ndc \
           --4field

```

Before transformation,

A1 | A2 | B1 | B2 | C1 | C2 
---|----|----|----|----|----
02396|24109|400126|400101G|05143|06169
020601G|6630|35282|440206|1515|070201G
020101G|02292|270519|070221|063402|060216
02699|3054|4636|070212|070227|12230
24104|03121|39113|540107|0876|070256
31123|3313|35257|51214|010201G|04177

After transformation to 4-field,

A1 | A2 | B1 | B2 | C1 | C2 
---|----|----|----|----|----
A*02:396|A*24:109|B*40:01:26|B*40:01:01|C*05:143|C*06:169
A*02:06:01:01|A*66:30|B*35:282|B*44:02:06|C*15:15|C*07:02:01:01
A*02:01:01:01|A*02:292|B*27:05:19|B*07:02:21|C*06:34:02|C*06:02:16
A*02:699|A*30:54|B*46:36|B*07:02:12|C*07:02:27|C*12:230
A*24:104|A*03:121|B*39:113|B*54:01:07|C*08:76|C*07:02:56
A*31:123|A*33:13|B*35:257|B*51:214|C*01:02:01:01|C*04:177


Similarly, you can obtain P-group allele names without digit/field information in 4-field standard names.

```console

$ python3 src/NomenCleaner.py \
            -ped-Pgroup data/NomenCleaner/DummyPED.Pgroup.Ncap.Ndc.100.ped \
            -iat data/ClassifyGroups/INTEGRATED_ALLELE_TABLE.imgt3320.iat \
            -o Transformed.Pgroup.100.ndc \
            --4field

```

Before transformation,

A1 | A2 | B1 | B2 | C1 | C2 
---|----|----|----|----|----
02174|0101P|5165|4901P|0401P|07323
2902P|0201P|5101P|5101P|03186P|07565
2403P|31107|5401P|0|0304P|1203P
2402P|2501P|0801P|39128|0408|0154
2402P|24142P|5758|4933|0801P|0
0|02654|0|0702P|0264|1406


After transformation to 4-field,


A1 | A2 | B1 | B2 | C1 | C2 
---|----|----|----|----|----
02:174|01:01:01:01|51:65|49:01:01:01|04:01:01:01|07:323
29:02:01:01|02:01:01:01|51:01:01:01|51:01:01:01|03:186:01|07:565
24:03:01:01|31:107|54:01:01|0|03:04:01:01|12:03:01:01
24:02:01:01|25:01:01:01|08:01:01:01|39:128|04:08|01:54
24:02:01:01|24:142:01|57:58|49:33|08:01:01:01|0
0|02:654|0|07:02:01:01|02:64|14:06

